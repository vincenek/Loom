<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Loom: A mindful digital space for reflection and meditation">
    <meta name="theme-color" content="#0a192f">
    <title>Loom | Mindful Digital Space</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%230a192f%22 width=%22100%22 height=%22100%22 rx=%2220%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22%23fff%22 opacity=%220.8%22/></svg>">
    <style>
        :root {
            --primary: #0a192f;
            --secondary: #112240;
            --accent: #64ffda;
            --light: #ccd6f6;
            --lighter: #e6f1ff;
            --transition: all 0.3s ease;
            --border-radius: 20px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            --card-bg: rgba(17, 34, 64, 0.7);
            --tab-active: rgba(100, 255, 218, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), #020c1b);
            color: var(--lighter);
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            line-height: 1.6;
        }
        
        #visual-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.8;
            filter: blur(1px);
        }
        
        #app-container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
        }
        
        /* Header Styles */
        header {
            padding: 20px;
            text-align: center;
            background: rgba(10, 25, 47, 0.8);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(100, 255, 218, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent), #4db5ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
        }
        
        h1 {
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: 1px;
            background: linear-gradient(to right, var(--light), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 5px;
        }
        
        .tagline {
            font-size: 1.1rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
            font-weight: 300;
        }
        
        /* Navigation Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }
        
        .tab {
            padding: 12px 24px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(100, 255, 218, 0.1);
            color: var(--lighter);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab.active {
            background: var(--tab-active);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .tab:hover:not(.active) {
            background: rgba(100, 255, 218, 0.05);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Chat Section */
        #chat-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid rgba(100, 255, 218, 0.1);
            height: 100%;
        }
        
        #chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .message {
            max-width: 80%;
            padding: 18px 20px;
            border-radius: 18px;
            animation: fadeIn 0.4s ease;
            line-height: 1.6;
            position: relative;
            font-size: 1.1rem;
        }
        
        .bot-message {
            align-self: flex-start;
            background: rgba(25, 55, 109, 0.4);
            border-bottom-left-radius: 5px;
            border: 1px solid rgba(100, 255, 218, 0.1);
        }
        
        .user-message {
            align-self: flex-end;
            background: rgba(100, 255, 218, 0.1);
            border-bottom-right-radius: 5px;
            border: 1px solid rgba(100, 255, 218, 0.15);
        }
        
        #input-container {
            display: flex;
            padding: 20px;
            background: rgba(10, 25, 47, 0.7);
            border-top: 1px solid rgba(100, 255, 218, 0.1);
            gap: 15px;
        }
        
        #user-input {
            flex-grow: 1;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(100, 255, 218, 0.1);
            border-radius: 30px;
            color: var(--lighter);
            font-size: 1.1rem;
            outline: none;
            transition: var(--transition);
        }
        
        #user-input:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(100, 255, 218, 0.2);
        }
        
        #user-input::placeholder {
            color: rgba(230, 241, 255, 0.4);
        }
        
        #send-btn {
            background: var(--accent);
            color: var(--primary);
            border: none;
            border-radius: 30px;
            padding: 0 30px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        #send-btn:hover {
            background: #7dffe3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(100, 255, 218, 0.3);
        }
        
        /* Meditation Section */
        .meditation-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(100, 255, 218, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }
        
        .meditation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .meditation-title {
            font-size: 1.5rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #timer-display {
            font-size: 3.5rem;
            font-weight: 300;
            font-variant-numeric: tabular-nums;
            color: var(--light);
            margin: 10px 0;
            text-align: center;
        }
        
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .timer-btn {
            background: rgba(100, 255, 218, 0.1);
            color: var(--accent);
            border: 1px solid var(--accent);
            border-radius: 30px;
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .timer-btn:hover {
            background: rgba(100, 255, 218, 0.2);
        }
        
        /* Breathing Exercise */
        #breathing-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(100, 255, 218, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            height: 100%;
        }
        
        #breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: rgba(100, 255, 218, 0.05);
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            transition: transform 0.5s ease;
        }
        
        #breathing-text {
            font-size: 1.8rem;
            font-weight: 500;
            color: var(--accent);
            z-index: 2;
        }
        
        .circle-pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(100, 255, 218, 0.1);
            animation: pulse 4s infinite ease-in-out;
            opacity: 0;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 0.5; }
        }
        
        .breathing-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Journal Section */
        .journal-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(100, 255, 218, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }
        
        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .journal-title {
            font-size: 1.5rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #journal-text {
            flex-grow: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(100, 255, 218, 0.1);
            border-radius: 15px;
            padding: 20px;
            color: var(--lighter);
            font-size: 1.1rem;
            resize: none;
            outline: none;
            transition: var(--transition);
        }
        
        #journal-text:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(100, 255, 218, 0.2);
        }
        
        .journal-btn {
            background: var(--accent);
            color: var(--primary);
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            margin-top: 10px;
        }
        
        .journal-btn:hover {
            background: #7dffe3;
            transform: translateY(-2px);
        }
        
        /* Footer */
        footer {
            padding: 20px;
            text-align: center;
            background: rgba(10, 25, 47, 0.8);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(100, 255, 218, 0.1);
            font-size: 0.9rem;
            color: rgba(230, 241, 255, 0.7);
        }
        
        .install-btn {
            background: rgba(100, 255, 218, 0.1);
            color: var(--accent);
            border: 1px solid var(--accent);
            border-radius: 30px;
            padding: 10px 25px;
            margin: 10px 0;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .install-btn:hover {
            background: rgba(100, 255, 218, 0.2);
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: rgba(25, 55, 109, 0.4);
            padding: 15px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            margin-left: 20px;
            border: 1px solid rgba(100, 255, 218, 0.1);
        }
        
        .typing-indicator span {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent);
            margin: 0 3px;
            opacity: 0.4;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); opacity: 1; }
        }
        
        /* Responsive Design */
        @media (max-width: 767px) {
            #app-container {
                padding: 15px;
            }
            
            header {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            #breathing-circle {
                width: 150px;
                height: 150px;
            }
            
            .message {
                max-width: 90%;
                padding: 15px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="visual-container"></div>
    
    <div id="app-container">
        <header>
            <div class="logo">
                <div class="logo-icon">☯</div>
                <h1>LOOM</h1>
            </div>
            <p class="tagline">A mindful space for reflection, meditation, and digital serenity</p>
        </header>
        
        <!-- Navigation Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="chat">
                <span>💬</span> Mindful Chat
            </div>
            <div class="tab" data-tab="meditation">
                <span>⏱️</span> Meditation
            </div>
            <div class="tab" data-tab="breathing">
                <span>🌬️</span> Breathing
            </div>
            <div class="tab" data-tab="journal">
                <span>📓</span> Journal
            </div>
        </div>
        
        <!-- Chat Tab -->
        <div id="chat-tab" class="tab-content active">
            <div id="chat-container">
                <div id="chat-messages">
                    <div class="message bot-message">
                        Welcome to Loom. I'm here to listen without judgment. How are you feeling in this moment?
                        <div class="timestamp">Just now</div>
                    </div>
                </div>
                
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <div id="input-container">
                    <input type="text" id="user-input" placeholder="Share your thoughts or feelings...">
                    <button id="send-btn">Send <span>➤</span></button>
                </div>
            </div>
        </div>
        
        <!-- Meditation Tab -->
        <div id="meditation-tab" class="tab-content">
            <div class="meditation-container">
                <div class="meditation-header">
                    <div class="meditation-title">
                        <span>⏱️</span> Meditation Timer
                    </div>
                </div>
                
                <div id="timer-display">05:00</div>
                
                <div class="timer-controls">
                    <button class="timer-btn" id="start-timer">Start</button>
                    <button class="timer-btn" id="pause-timer">Pause</button>
                    <button class="timer-btn" id="reset-timer">Reset</button>
                </div>
                
                <div class="meditation-content">
                    <p>Find a comfortable position, close your eyes, and focus on your breath. Let thoughts come and go without judgment.</p>
                    <p style="margin-top: 15px;">"Meditation is not about stopping thoughts, but recognizing that we are more than our thoughts."</p>
                </div>
            </div>
        </div>
        
        <!-- Breathing Tab -->
        <div id="breathing-tab" class="tab-content">
            <div class="breathing-container">
                <div class="meditation-header">
                    <div class="meditation-title">
                        <span>🌬️</span> Breathing Exercise
                    </div>
                </div>
                
                <p>Follow the rhythm to calm your mind and body</p>
                <div id="breathing-circle">
                    <div id="breathing-text">Breathe In</div>
                    <div class="circle-pulse"></div>
                </div>
                
                <div class="breathing-controls">
                    <button class="timer-btn" id="start-breathing">Start</button>
                    <button class="timer-btn" id="stop-breathing">Stop</button>
                </div>
                
                <div class="breathing-instructions">
                    <p>Inhale for 4 seconds → Hold for 4 seconds → Exhale for 6 seconds → Hold for 2 seconds</p>
                    <p style="margin-top: 15px;">This technique helps activate your parasympathetic nervous system, promoting relaxation.</p>
                </div>
            </div>
        </div>
        
        <!-- Journal Tab -->
        <div id="journal-tab" class="tab-content">
            <div class="journal-container">
                <div class="journal-header">
                    <div class="journal-title">
                        <span>📓</span> Mindfulness Journal
                    </div>
                </div>
                
                <textarea id="journal-text" placeholder="What's on your mind today? What are you grateful for?"></textarea>
                
                <button class="journal-btn" id="save-journal">Save Reflection</button>
                
                <div class="journal-tips">
                    <p>Journaling prompts:</p>
                    <ul style="margin-top: 10px; margin-left: 20px;">
                        <li>What emotions am I feeling right now?</li>
                        <li>What am I grateful for today?</li>
                        <li>What lesson did I learn recently?</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Loom is designed to help you find moments of peace in your digital life</p>
            <button class="install-btn" id="install-btn">⬇️ Install Loom App</button>
            <p>© 2023 Loom Meditation. All rights reserved.</p>
        </footer>
    </div>
    
    <script>
        // Enhanced Visual Experience
        const visualContainer = document.getElementById('visual-container');
        const canvas = document.createElement('canvas');
        visualContainer.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = visualContainer.clientWidth;
            canvas.height = visualContainer.clientHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // Particle system with improved visuals
        class Particle {
            constructor() {
                this.reset();
                this.size = Math.random() * 8 + 2;
            }
            
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.8;
                this.vy = (Math.random() - 0.5) * 0.8;
                this.alpha = Math.random() * 0.4 + 0.1;
                this.color = `hsla(${170 + Math.random() * 60}, 70%, 60%, ${this.alpha})`;
                this.life = Math.random() * 300 + 100;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life--;
                
                // Organic movement
                this.vx += (Math.random() - 0.5) * 0.1;
                this.vy += (Math.random() - 0.5) * 0.1;
                
                // Constrain velocity
                this.vx = Math.max(Math.min(this.vx, 1), -1);
                this.vy = Math.max(Math.min(this.vy, 1), -1);
                
                // Boundary check
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height || this.life <= 0) {
                    this.reset();
                }
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // Draw connections to nearby particles
                for (let particle of particles) {
                    if (particle !== this) {
                        const dx = this.x - particle.x;
                        const dy = this.y - particle.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < 150) {
                            ctx.beginPath();
                            ctx.moveTo(this.x, this.y);
                            ctx.lineTo(particle.x, particle.y);
                            ctx.strokeStyle = `hsla(170, 60%, 70%, ${0.1 * (1 - dist/150)})`;
                            ctx.lineWidth = 0.8;
                            ctx.stroke();
                        }
                    }
                }
            }
        }
        
        // Create particles
        const particles = [];
        const particleCount = 80;
        
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }
        
        // Animation loop
        function animate() {
            ctx.fillStyle = 'rgba(10, 25, 47, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            
            requestAnimationFrame(animate);
        }
        
        animate();
        
        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.querySelector('.typing-indicator');
        const startTimerBtn = document.getElementById('start-timer');
        const pauseTimerBtn = document.getElementById('pause-timer');
        const resetTimerBtn = document.getElementById('reset-timer');
        const timerDisplay = document.getElementById('timer-display');
        const startBreathingBtn = document.getElementById('start-breathing');
        const stopBreathingBtn = document.getElementById('stop-breathing');
        const saveJournalBtn = document.getElementById('save-journal');
        const journalText = document.getElementById('journal-text');
        const installBtn = document.getElementById('install-btn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Tab Navigation
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // Meditation Timer
        let timerInterval;
        let timerRunning = false;
        let timerSeconds = 300; // 5 minutes
        let timerPaused = false;
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            return `${mins}:${secs}`;
        }
        
        function startTimer() {
            if (timerRunning) return;
            
            timerRunning = true;
            timerPaused = false;
            
            timerInterval = setInterval(() => {
                timerSeconds--;
                timerDisplay.textContent = formatTime(timerSeconds);
                
                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    playCompletionSound();
                    addMessage("Your meditation session is complete. How do you feel now?", false);
                }
            }, 1000);
        }
        
        function pauseTimer() {
            if (timerRunning && !timerPaused) {
                clearInterval(timerInterval);
                timerPaused = true;
            } else if (timerRunning && timerPaused) {
                startTimer();
            }
        }
        
        function resetTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
            timerPaused = false;
            timerSeconds = 300;
            timerDisplay.textContent = formatTime(timerSeconds);
        }
        
        startTimerBtn.addEventListener('click', startTimer);
        pauseTimerBtn.addEventListener('click', pauseTimer);
        resetTimerBtn.addEventListener('click', resetTimer);
        
        // Breathing Exercise
        let breathingInterval;
        let breathingActive = false;
        let breathPhase = 0; // 0: inhale, 1: hold, 2: exhale, 3: hold
        
        function startBreathing() {
            if (breathingActive) return;
            
            breathingActive = true;
            breathingCircle.style.transform = 'scale(1)';
            breathPhase = 0;
            updateBreathing();
            
            breathingInterval = setInterval(updateBreathing, 4000);
        }
        
        function stopBreathing() {
            breathingActive = false;
            clearInterval(breathingInterval);
            breathingCircle.style.transform = 'scale(1)';
            breathingText.textContent = 'Breathe In';
        }
        
        function updateBreathing() {
            switch(breathPhase) {
                case 0: // Inhale
                    breathingText.textContent = 'Breathe In';
                    breathingCircle.style.transform = 'scale(1.2)';
                    breathPhase = 1;
                    break;
                case 1: // Hold after inhale
                    breathingText.textContent = 'Hold';
                    breathPhase = 2;
                    break;
                case 2: // Exhale
                    breathingText.textContent = 'Breathe Out';
                    breathingCircle.style.transform = 'scale(0.8)';
                    breathPhase = 3;
                    break;
                case 3: // Hold after exhale
                    breathingText.textContent = 'Hold';
                    breathPhase = 0;
                    break;
            }
        }
        
        startBreathingBtn.addEventListener('click', startBreathing);
        stopBreathingBtn.addEventListener('click', stopBreathing);
        
        // Journal Saving
        saveJournalBtn.addEventListener('click', () => {
            const text = journalText.value.trim();
            if (!text) {
                alert('Please write something before saving!');
                return;
            }
            
            // Save to localStorage
            const entries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
            entries.push({
                id: Date.now(),
                content: text,
                date: new Date().toISOString()
            });
            
            localStorage.setItem('journalEntries', JSON.stringify(entries));
            
            // Show confirmation
            alert('Journal entry saved successfully!');
            journalText.value = '';
        });
        
        // Context-Aware Chatbot
        const conversationContext = {
            lastMentioned: '',
            sentiment: 'neutral',
            topics: [],
            mood: 'calm'
        };
        
        const responses = {
            greeting: [
                "Welcome. I'm here to listen without judgment. How are you feeling in this moment?",
                "Hello. This space is for you. What's present for you right now?",
                "I'm here. Take a deep breath and share what's on your mind."
            ],
            positive: [
                "That's beautiful to hear. Joy can be such a gentle teacher. What's bringing you this sense of contentment?",
                "I sense your positivity. How might you nurture this feeling throughout your day?",
                "Moments of happiness are precious. Can you describe the sensations you're experiencing?",
                "Your contentment is palpable. What's the source of this peace you're feeling?"
            ],
            negative: [
                "I'm here with you. Difficult emotions are part of the human experience. Would you like to explore this feeling more deeply?",
                "Thank you for sharing that. Remember, emotions are like weather patterns - they come and go. What do you need in this moment?",
                "I sense your discomfort. Can you describe where you feel this in your body?",
                "This too shall pass, but right now, I'm here to sit with you in this feeling."
            ],
            reflective: [
                "What do you notice arising within you as you share this?",
                "How does this resonate with your deeper understanding of yourself?",
                "Our thoughts are like clouds passing through the sky of awareness. What do you observe?",
                "Can you sit with that feeling without judgment for just a moment? What do you notice?"
            ],
            existential: [
                "We're the universe experiencing itself. How does that feel to contemplate?",
                "What does it mean to you to be alive in this particular moment of time?",
                "In the grand scheme, this moment is both insignificant and everything. How does that resonate?",
                "What does presence mean to you in this fleeting existence?"
            ],
            nature: [
                "Imagine yourself as a mountain - grounded, stable, observing the changing weather of emotions.",
                "Consider the trees - they don't rush their growth, yet they reach incredible heights.",
                "The changing seasons remind us that nothing is permanent. How does that land for you?",
                "Can you hear the rhythm of your breath, like waves on a shore? Each one unique."
            ],
            mindful: [
                "Bring your attention to your breath. Notice the sensation of air entering and leaving your body.",
                "Can you name three things you're sensing right now? Sight, sound, touch?",
                "When was the last time you truly listened to the silence between sounds?",
                "Try gently resting your awareness on the space between your thoughts."
            ],
            followup: [
                "Earlier you mentioned {topic}. How does that relate to what you're sharing now?",
                "I recall you spoke about {topic}. Would you like to explore that further?",
                "Building on our previous conversation about {topic}, how are you feeling about that now?"
            ],
            default: [
                "I'm listening. Please continue.",
                "What else comes to mind as you reflect on that?",
                "How does that resonate in your body right now?",
                "Let's explore that thought together, without judgment.",
                "What's the next layer beneath that thought?"
            ]
        };
        
        // Sentiment analysis with context
        function analyzeSentiment(text) {
            text = text.toLowerCase();
            
            const positiveWords = ['good', 'great', 'happy', 'joy', 'love', 'excited', 'calm', 'peace', 'grateful', 'content', 'relaxed'];
            const negativeWords = ['bad', 'sad', 'angry', 'stressed', 'anxious', 'depressed', 'tired', 'hurt', 'lonely', 'overwhelmed', 'fear'];
            const mindfulWords = ['breathe', 'present', 'moment', 'now', 'aware', 'meditate', 'mindful', 'observe', 'notice'];
            
            let positiveCount = 0;
            let negativeCount = 0;
            let mindfulCount = 0;
            
            positiveWords.forEach(word => {
                if (text.includes(word)) positiveCount++;
            });
            
            negativeWords.forEach(word => {
                if (text.includes(word)) negativeCount++;
            });
            
            mindfulWords.forEach(word => {
                if (text.includes(word)) mindfulCount++;
            });
            
            if (mindfulCount > 2) return 'mindful';
            if (positiveCount > negativeCount) return 'positive';
            if (negativeCount > positiveCount) return 'negative';
            return 'neutral';
        }
        
        // Extract topics from text
        function extractTopics(text) {
            const topics = [];
            const topicKeywords = [
                'work', 'family', 'friend', 'relationship', 'health', 'sleep', 
                'dream', 'future', 'past', 'present', 'nature', 'art', 'music',
                'meditation', 'breath', 'mind', 'body', 'soul', 'purpose'
            ];
            
            topicKeywords.forEach(keyword => {
                if (text.includes(keyword) && !topics.includes(keyword)) {
                    topics.push(keyword);
                }
            });
            
            return topics;
        }
        
        // Generate context-aware response
        function generateResponse(userMessage) {
            const sentiment = analyzeSentiment(userMessage);
            const now = new Date();
            const timestamp = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Update conversation context
            conversationContext.sentiment = sentiment;
            conversationContext.topics = [...conversationContext.topics, ...extractTopics(userMessage)];
            
            // Occasionally reference previous topic
            if (Math.random() > 0.7 && conversationContext.topics.length > 0) {
                const randomTopic = conversationContext.topics[Math.floor(Math.random() * conversationContext.topics.length)];
                const followup = responses.followup[Math.floor(Math.random() * responses.followup.length)];
                return {
                    text: followup.replace('{topic}', randomTopic),
                    timestamp
                };
            }
            
            // Sometimes suggest mindfulness
            if (Math.random() > 0.8) {
                return {
                    text: responses.mindful[Math.floor(Math.random() * responses.mindful.length)],
                    timestamp
                };
            }
            
            // Occasionally go existential
            if (Math.random() > 0.85) {
                return {
                    text: responses.existential[Math.floor(Math.random() * responses.existential.length)],
                    timestamp
                };
            }
            
            // Sometimes talk about nature
            if (Math.random() > 0.8) {
                return {
                    text: responses.nature[Math.floor(Math.random() * responses.nature.length)],
                    timestamp
                };
            }
            
            // Base response on sentiment
            if (sentiment === 'positive') {
                return {
                    text: responses.positive[Math.floor(Math.random() * responses.positive.length)],
                    timestamp
                };
            }
            
            if (sentiment === 'negative') {
                return {
                    text: responses.negative[Math.floor(Math.random() * responses.negative.length)],
                    timestamp
                };
            }
            
            if (sentiment === 'mindful') {
                return {
                    text: responses.mindful[Math.floor(Math.random() * responses.mindful.length)],
                    timestamp
                };
            }
            
            return {
                text: responses.default[Math.floor(Math.random() * responses.default.length)],
                timestamp
            };
        }
        
        // Add message to chat
        function addMessage(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
            messageDiv.innerHTML = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Simulate typing
        function showTyping() {
            typingIndicator.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function hideTyping() {
            typingIndicator.style.display = 'none';
        }
        
        // Handle user message
        function handleUserMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Add user message
            const now = new Date();
            const timestamp = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            addMessage(`${message}<div class="timestamp">${timestamp}</div>`, true);
            
            userInput.value = '';
            
            // Show typing indicator
            showTyping();
            
            // Generate and show bot response after delay
            setTimeout(() => {
                hideTyping();
                const response = generateResponse(message);
                addMessage(`${response.text}<div class="timestamp">${timestamp}</div>`, false);
            }, 1500 + Math.random() * 1500);
        }
        
        // Sound system
        let audioContext;
        let oscillator;
        let soundOn = true;
        
        function initSound() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 220;
                gainNode.gain.value = 0.02;
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                
                // Slowly modulate frequency for ambient effect
                setInterval(() => {
                    oscillator.frequency.setValueAtTime(
                        200 + Math.sin(Date.now() / 5000) * 50, 
                        audioContext.currentTime
                    );
                }, 100);
            } catch (e) {
                console.log("Web Audio API not supported:", e);
            }
        }
        
        function playCompletionSound() {
            if (!audioContext) return;
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'sine';
            osc.frequency.value = 440;
            gain.gain.value = 0.1;
            
            osc.connect(gain);
            gain.connect(audioContext.destination);
            
            osc.start();
            
            // Fade out
            gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.5);
            osc.stop(audioContext.currentTime + 1.5);
        }
        
        // PWA Installation
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'inline-flex';
        });
        
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.textContent = '✓ App Installed';
                    installBtn.disabled = true;
                }
                deferredPrompt = null;
            }
        });
        
        // Event listeners
        sendBtn.addEventListener('click', handleUserMessage);
        
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleUserMessage();
            }
        });
        
        // Initialize
        window.addEventListener('load', () => {
            initSound();
            
            // Add initial bot message after a pause
            setTimeout(() => {
                addMessage("Notice your breath as you read this. There's no rush. This space is just for you.");
            }, 3000);
            
            // Service Worker Registration
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            }
        });
    </script>
</body>
</html>